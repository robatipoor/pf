<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paste File</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.qrcode@1.0.3/jquery.qrcode.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        #uploadForm {
            margin-bottom: 20px;
        }

        .progress-bar {
            display: none;
            width: 50%;
            background-color: #f1f1f1;
            margin-bottom: 20px;
            border: 3px solid green;
            margin: auto;
            &.is-active {
                display: block;
            }
        }

        .progress {
            width: 0%;
            height: 30px;
            background-color: #4caf50;
            line-height: 30px;
            color: white;
        }

        #qrcode {
            margin-top: 20px;
        }

        h1 {
            font-size: 20px;
            margin-top: 24px;
            margin-bottom: 24px;
        }

        img {
            height: 40px;
        }

        .success {
            display: none;
            background: #E1F8ED;
            padding: 20px;
            margin-top: 16px;
            margin-bottom: 16px;

            &.is-active {
                display: block;
            }
        }
    </style>
</head>

<body>
    <h2>Paste File</h2>
    <div class="col-md-6 offset-md-3 mt-5">
        <form accept-charset="UTF-8" action="{{ domain }}/upload" method="POST" enctype="multipart/form-data"
            target="_blank" id="ajaxForm">
            <div class="form-group">
                <label for="codeLength">Code length: </label>
                <input type="number" name="codeLength" class="form-control" id="codeLength"
                    aria-describedby="codeLengthHelp" placeholder="Enter number length">
            </div>
            <div class="form-group">
                <label for="expireTime">Expire time: </label>
                <input type="number" name="expireTime" class="form-control" id="expireTime"
                    placeholder="Enter second number">
            </div>
            <div class="form-group">
                <label for="maxDownload">Maximum download: </label>
                <input type="number" name="maxDownload" class="form-control" id="maxDownload"
                    placeholder="Enter max number">
            </div>
            <div class="form-group">
                <label for="Username">Username: </label>
                <input type="text" name="Username" class="form-control" id="Username" placeholder="Enter username">
            </div>
            <div class="form-group">
                <label for="Password">Password: </label>
                <input type="password" name="Password" class="form-control" id="Password" placeholder="Enter password">
            </div>
            <div class="form-group">
                <label for="allowManualDeletion">Allow manual deletion: </label>
                <select class="form-control" id="allowManualDeletion" name="platform">
                    <option>True</option>
                    <option>False</option>
                </select>
            </div>
            <div class="form-group">
                <label for="input">Input: </label>
                <select class="form-control" id="input" name="platform">
                    <option>File</option>
                    <option>Clipboard</option>
                </select>
            </div>
            <hr>
            <div class="form-group mt-3">
                <label class="mr-2">File:</label>
                <input type="file" name="file" required="required">
            </div>
            <hr>
            <button type="submit" class="btn btn-primary">Upload</button>
        </form>
    </div>
    <div class="progress-bar">
        <div id="progress" class="progress">0%</div>
    </div>
    <div id="urlDisplay" class="success">
        <p>URL: <span><strong id="result-url"></strong></span></p>
        <button id="copyButton">Copy URL</button>
    </div>
    <div id="qrcode"></div>
    <script>
        $("#ajaxForm").submit(function (e) {
            e.preventDefault();
            $('.progress-bar').addClass('is-active');
            var action = $(this).attr("action");
            $.ajax({
                xhr: function () {
                    var xhr = new window.XMLHttpRequest();
                    xhr.upload.addEventListener("progress", function (evt) {
                        if (evt.lengthComputable) {
                            var percentComplete = (evt.loaded / evt.total) * 100;

                            $('#progress')[0].style.width = percentComplete + '%';
                            $('#progress')[0].innerHTML = percentComplete.toFixed(1) + '%';
                        }
                    }, false);
                    return xhr;
                },
                type: "POST",
                url: action,
                crossDomain: true,
                data: new FormData(this),
                dataType: "json",
                contentType: "multipart/form-data",
                processData: false,
                contentType: false,
                headers: {
                    "Accept": "application/json"
                },
                success: function (response) {
                    $('.success').addClass('is-active');
                    $('#result-url').empty();
                    $("#result-url").append(response.url);
                    $('#qrcode').empty();
                    $('#qrcode').qrcode({ width: 256, height: 256, text: response.url });
                },
            }).fail(function () {
                alert('An error occurred please try again later.')
            });
        });
        $("#copyButton").click(function (event) {
            event.preventDefault();
            navigator.clipboard.writeText($('#result-url').text()).then(() => { });
            alert('URL copied to clipboard!');
        });
    </script>

</body>

</html>